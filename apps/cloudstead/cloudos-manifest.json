{
    "name": "cloudstead",
    "version": "0.1.0",
    "style": "java_webapp",
    "publisher": {
        "maintainer": "Jonathan Cobb",
        "maintainer_email": "jonathan@cloudstead.io",
        "license": "https://www.gnu.org/licenses/agpl-3.0.txt",
        "code_copyright": "Copyright 2014 Cloudstead, Inc.",
        "packaging_copyright": "Copyright 2014 Cloudstead, Inc."
    },

    "config": [
        {
            "name": "base",
            "items": [ "hostname", "parent_domain", "ssl_cert_name" ]
        }, {
            "name": "init",
            "items": [
                "server_tarball", "cloudos_server_tarball",
                "aws_access_key", "aws_secret_key", "aws_iam_group", "s3_bucket",
                "data_key", "cloud_storage_user",
                "do_client_id", "do_api_key",
                "rackspace_client_id", "rackspace_api_key",
                "wildcard_cert_name",
                "sendgrid.user", "sendgrid.password",
                "authy.user", "authy.base_uri",
                "authy_admin.user", "authy_admin.base_uri",
                "cloudos_dns.user", "cloudos_dns.password", "cloudos_dns.base_uri",
                "cloudos_appstore.user", "cloudos_appstore.password", "cloudos_appstore.base_uri"
            ]
        }
    ],

    "packages": [ "memcached", "redis-server" ],

    "tarball": { "url": "@config[init][server_tarball]" },

    "database": { "type": "postgresql", "schema_version": "1.0" },

    "web": { "type": "apache", "mode": "proxy_service" },

    "templates": {
        ".cloudstead.env": "dot-cloudstead.env",
        "install_ssl_certs.sh": "_",
        "/usr/bin/cstead": "_"
    },

    "symlinks": { "/usr/bin/cos": "/usr/bin/cstead" },

    "dirs": [
        "@name/cloudos-chef/data_files",
        "@name/cloudos-chef-staging"
    ],

    "copy": {
        "@files/dot-cstead-commands": "@name/.cstead-commands",
        "/opt/cloudos/geoip": "@name/cloudos-chef/data_files/"
    },

    "perms": {
        "install_ssl_certs.sh": { "chown": "@run_as.root", "perms": "700" },
        "/usr/bin/cstead": { "chown": "@run_as.root", "perms": "750" }
    },

    "post_install": [
        { "exec": "@home/install_ssl_certs.sh" },
        { "exec": "/usr/bin/cstead dns --operation add --record a --fqdn @hostname --value @ipaddress --ttl 14400" },
        { "exec": "/usr/bin/cstead accode @config[init][activation][name] @config[init][activation][quantity] @config[init][activation][expiration_days]" }
    ],

    "sysinit": [ "jrun:cloudos.cloudstead.server.CloudsteadServer" ]
}