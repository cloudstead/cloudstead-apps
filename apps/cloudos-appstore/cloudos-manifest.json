{
    "name": "cloudos-appstore",
    "version": "0.1.0",
    "style": "java_webapp",
    "publisher": {
        "maintainer": "Jonathan Cobb",
        "maintainer_email": "jonathan@cloudstead.io",
        "license": "https://www.gnu.org/licenses/agpl-3.0.txt",
        "code_copyright": "Copyright 2014 Cloudstead, Inc.",
        "packaging_copyright": "Copyright 2014 Cloudstead, Inc."
    },

    "config": [ {
        "name": "init",
        "items": [ "admin.name", "admin.password", "admin.email",
                   "sendgrid.user", "sendgrid.password",
                   "initial_apps" ]
    } ],

    "tarball": {
        "url": "http://cloudstead.io/downloads/cloudos-appstore-server.tar.gz",
        "shasum": "c1f0bfbdb6fb626272f239b055b3a794bf422c13efab0e5b0ce30b2cf1b42c82"
    },

    "database": {
        "type": "postgresql",
        "schema_version": "1.0",
        "inserts": [
            { "sql": "UPDATE app_store_account SET name='@config[init][admin][name]', hashed_password = '@bcrypt(@config[init][admin][password], 12)', email = '@config[init][admin][email]', email_verified = true WHERE uuid = (SELECT uuid FROM app_store_account WHERE admin = true AND email = '_@_')",
              "unless": "SELECT COUNT(*) FROM app_store_account WHERE email='@config[init][admin][email]'" }
        ]
    },

    "web": { "type": "apache", "mode": "proxy_service", "mount": "appstore" },

    "templates": {
        ".cloudos-appstore.env": "dot-cloudos-appstore.env",
        "/usr/bin/cas": "_",
        "/usr/bin/init_appstore.sh": "_"
    },

    "copy": {
        "@files/dot-cas-commands": "@name/.cas-commands"
    },

    "perms": {
        "/usr/bin/cas": { "chown": "@run_as.root", "perms": "750" }
    },

    "sysinit": [ "jrun" ],

    "post_install": [ {
        "exec": "/usr/bin/init_appstore.sh @config[init][admin][name] http://127.0.0.1:@config[ports][primary]/",
        "env": { "APPSTORE_PASS": "@config[init][admin][password]" }
    } ],

    "validation": { "service_url": "/auth" },

    "auth": {}
}